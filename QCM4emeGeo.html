<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>QCM : Quadrilat√®res et Triangles</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        #timer {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: #e74c3c;
        }
        form {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .question {
            margin-bottom: 20px;
        }
        .feedback {
            font-weight: bold;
            margin-top: 10px;
            padding: 5px;
            border-radius: 5px;
        }
        .feedback.green {
            background-color: #3CB371; /* MediumSeaGreen */
            color: white;
        }
        .feedback.greenlight {
            background-color: #90EE90; /* LightGreen */
            color: #006400; /* DarkGreen */
        }
        .feedback.greendark {
            background-color: #228B22; /* ForestGreen */
            color: white;
        }
        .feedback.orange {
            background-color: #ffeeba;
            color: #856404;
        }
        .feedback.red {
            background-color: #f8d7da;
            color: #721c24;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        #resultat {
            margin-top: 20px;
            font-weight: bold;
            font-size: 18px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>QCM : Quadrilat√®res et Triangles</h1>
    <div id="timer">Temps restant : 10:00</div>
    <button onclick="demanderCode()">Afficher le QCM</button>
    <form id="qcm"></form>
    <p id="resultat"></p>

    <script>
        const questions = [
            { "text": "Quel quadrilat√®re poss√®de ses c√¥t√©s oppos√©s parall√®les ?", "options": ["Rectangle", "Losange", "Carr√©", "Trap√®ze"], "correct": [0, 1, 2] },
            { "text": "Quelles sont les propri√©t√©s d'un parall√©logramme ?", "options": ["C√¥t√©s oppos√©s parall√®les", "Diagonales de m√™me longueur", "Centre de sym√©trie", "Diagonales perpendiculaires"], "correct": [0, 2] },
            { "text": "Quelle est la d√©finition correcte d‚Äôun losange ?", "options": ["Quadrilat√®re avec 4 c√¥t√©s √©gaux", "Parall√©logramme avec diagonales perpendiculaires", "Rectangle avec 4 angles droits", "Quadrilat√®re quelconque"], "correct": [0, 1] },
            { "text": "Quelles sont les propri√©t√©s d‚Äôun carr√© ?", "options": ["4 c√¥t√©s √©gaux", "4 angles droits", "Diagonales perpendiculaires", "Un seul axe de sym√©trie"], "correct": [0, 1, 2] },
            { "text": "Parmi les quadrilat√®res suivants, lequel est toujours un parall√©logramme ?", "options": ["Carr√©", "Rectangle", "Trap√®ze rectangle", "Trap√®ze isoc√®le"], "correct": [0, 1] },
            { "text": "Quelles sont les propri√©t√©s d‚Äôun losange ?", "options": ["Les diagonales sont perpendiculaires", "Les diagonales sont de m√™me longueur", "Il poss√®de un centre de sym√©trie", "Les diagonales se coupent en leur milieu"], "correct": [0, 2, 3] },
            { "text": "Quelles sont les d√©finitions correctes d‚Äôun carr√© ?", "options": ["C‚Äôest un rectangle avec 4 c√¥t√©s de m√™me longueur", "C‚Äôest un losange avec 4 angles droits", "C‚Äôest un parall√©logramme avec des diagonales de m√™me longueur", "C‚Äôest un quadrilat√®re quelconque"], "correct": [0, 1, 2] },
            { "text": "Quelle est la d√©finition d‚Äôun parall√©logramme ?", "options": ["Un quadrilat√®re avec ses diagonales perpendiculaires", "Un quadrilat√®re avec un seul axe de sym√©trie", "Un quadrilat√®re avec des c√¥t√©s oppos√©s parall√®les", "Un quadrilat√®re avec ses diagonales √©gales"], "correct": [2] },
            { "text": "Quelle est la propri√©t√© des diagonales d‚Äôun rectangle ?", "options": ["Elles sont perpendiculaires", "Elles sont de m√™me longueur", "Elles ne se croisent pas", "Elles sont axes de sym√©trie"], "correct": [1] },
            { "text": "Quel quadrilat√®re a exactement deux axes de sym√©trie ?", "options": ["Le losange", "Le carr√©", "Le rectangle", "Le trap√®ze isoc√®le"], "correct": [2] }
        ];

        let timer;
        let timerRunning = false;

        function demanderCode() {
            const code = prompt("Veuillez entrer le code pour afficher le QCM :");
            if (code === "LOSANGE") {
                afficherQCM();
            } else {
                alert("Code incorrect !");
            }
        }

        function afficherQCM() {
            const questionsAleatoires = tirerQuestionsAleatoires(questions, 10);
            genererQuestions(questionsAleatoires);
            if (!timerRunning) {
                lancerTimer(10 * 60);
                timerRunning = true;
            }
        }

        function tirerQuestionsAleatoires(array, n) {
            const shuffled = array.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, n);
        }

        function genererQuestions(questionsToDisplay) {
            const form = document.getElementById('qcm');
            form.innerHTML = "";

            questionsToDisplay.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question');
                let questionHTML = `<div class="question-text"><p><strong>Question ${index + 1} :</strong> ${q.text}</p>`;
                q.options.forEach((option, i) => {
                    questionHTML += `<input type="checkbox" name="q${index}" value="${i}"> ${String.fromCharCode(65 + i)}) ${option}<br>`;
                });
                questionHTML += `</div>`;
                questionDiv.innerHTML = questionHTML;
                form.appendChild(questionDiv);
            });

            const corrigerButton = document.createElement('button');
            corrigerButton.type = 'button';
            corrigerButton.textContent = 'Corriger';
            corrigerButton.onclick = corriger;
            form.appendChild(corrigerButton);
        }

        function lancerTimer(duration) {
            let timerDisplay = document.getElementById('timer');
            timer = setInterval(() => {
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                timerDisplay.textContent = `Temps restant : ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                duration--;

                if (duration < 0) {
                    clearInterval(timer);
                    verrouillerQuestions();
                    timerDisplay.textContent = "Temps √©coul√© !";
                }
            }, 1000);
        }

        function verrouillerQuestions() {
            const inputs = document.querySelectorAll('input[type="checkbox"]');
            inputs.forEach(input => input.disabled = true);
        }

        function corriger() {
            clearInterval(timer);
            verrouillerQuestions();

            let score = 0;
            const questionsDiv = document.querySelectorAll('.question');
            let toutesReponsesValides = true;

            questionsDiv.forEach((questionDiv, index) => {
                const checkedOptions = document.querySelectorAll(`input[name="q${index}"]:checked`);
                if (checkedOptions.length === 0) {
                    toutesReponsesValides = false;
                    questionDiv.style.border = "2px solid red";
                } else {
                    questionDiv.style.border = "none";
                }
            });

            if (!toutesReponsesValides) {
                alert("Veuillez cocher au moins une r√©ponse pour chaque question !");
                return;
            }

            questionsDiv.forEach((questionDiv, index) => {
                const checkedOptions = document.querySelectorAll(`input[name="q${index}"]:checked`);
                const selectedAnswers = Array.from(checkedOptions).map(input => parseInt(input.value));
                const correctOptions = questions[index].correct;  // Tableau des indices des bonnes r√©ponses
                const nombreDeBonnesReponses = correctOptions.length;  // Nombre de bonnes r√©ponses
                let points = 0;
                correctOptions.forEach(opt => {
                    if (selectedAnswers.includes(opt)) points += 1/nombreDeBonnesReponses;
                });

                for (let i = 0; i < questions[index].options.length; i++) {
                    if (!correctOptions.includes(i) && selectedAnswers.includes(i)) {
                        points -= 0.25*nombreDeBonnesReponses;  // Retire 0.25 point pour chaque mauvaise r√©ponse coch√©e
                    }
                }
                points = Math.max(0, Math.min(points, 1));
                score += points;

                const feedback = document.createElement('div');
                feedback.classList.add('feedback');
                if (points === 1) {
                    feedback.classList.add('greendark');
                    feedback.textContent = "Parfait ! Toutes les bonnes r√©ponses sont s√©lectionn√©es. ‚úîÔ∏è üòé";
                } else if (points >= 0.75 && points < 1) {
                    feedback.classList.add('green');
                    feedback.textContent = `Partiellement parfait : ${Math.round(points * 100)}% des points. üòä`;
                } else if (points >= 0.5 && points < 0.75) {
                    feedback.classList.add('greenlight');
                    feedback.textContent = `Partiellement correct : ${Math.round(points * 100)}% des points. ü§î`;
                } else if (points > 0 && points < 0.5) {
                    feedback.classList.add('orange');
                    feedback.textContent = `Partiellement correct : ${Math.round(points * 100)}% des points. ‚ö†Ô∏èü§î`;
                } else {
                    feedback.classList.add('red');
                    feedback.textContent = "Incorrect : aucune bonne r√©ponse. ‚ùå üò≤";
                }
                questionDiv.appendChild(feedback);
            });

            document.getElementById('resultat').innerHTML = `Votre score total : ${score.toFixed(2)} / 10`;
        }
    </script>
</body>
</html>
